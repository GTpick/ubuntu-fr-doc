{{tag>Trusty Precise vidéo système carte_graphique}}

----
====== X.org ======

**X.org** est un logiciel libre de type [[wpfr>X_Window_System|serveur X]] pour les systèmes d'exploitation UNIX.\\
À partir de la version 7.4 de X.org (soit à partir d'Ubuntu [[:Intrepid|8.10 Intrepid]]), le serveur X se configure automatiquement au démarrage.\\
Le fichier **/etc/X11/xorg.conf** qui sert à paramétrer le serveur X est donc quasiment vide voire inexistant sur les dernières versions d'Ubuntu.
  
Cependant, dans certains cas, la détection automatique ne fonctionne pas. Il faut donc paramétrer manuellement ce fichier **xorg.conf** . Plusieurs cas peuvent en être la cause :
  * Deux cartes graphiques dans l'ordinateur (le serveur X ne parvient pas à localiser la carte sur laquelle l'écran principal est branché.)
  * Certains modèles d'écrans et de cartes graphiques sont mal détectés (cela empêche le démarrage du serveur X)
  * Liste à compléter.
Dans ces cas, il est possible que le serveur X renvoie un message de ce type :
<code>No screens found</code>

=====Connaître sa version d'Xorg=====
Avant de commencer toute manipulation, il peut être intéressant de connaître sa version d'Xorg avec celle du [[:kernel|noyau Linux]] correpondant. Pour cela, dans un [[:terminal]], saisir la [[:commande_shell|commande]] suivante : <code>Xorg -version</code> Le [[:terminal]] vous répondra entre-autres les lignes suivantes: //(Exemple avec [[trusty|Trusty]] 14.04.3)//<code>X.Org X Server 1.17.1
Release Date: 2015-02-10
X Protocol Version 11, Revision 0
Build Operating System: Linux 3.19.0-28-generic x86_64 Ubuntu</code>
 


===== Structure d'un fichier Xorg basique =====
Le fichier se compose de plusieurs sections. La section ayant le plus haut-niveau est //"ServerLayout"// :
<file>
Section "ServerLayout"
    Identifier    "Default Layout"
    Screen        "Ecran"
    InputDevice   "Generic Keyboard"
    InputDevice   "Configured Mouse"
EndSection
</file>

Cette section est dépendante des autres sections, comme ce schéma peut le résumer :

{{systeme:xorg.jpg|Principe du fichier xorg.conf}}

En résumé, s'il y a une donnée incorrecte à un endroit ou un autre, X.org affiche un message d'erreur de couleur bleue (cf. [[#Que faire en cas d'écran bleu parlant de "Xorg.0.log"?|plus bas]]).\\
<note important>Sur les dernières versions, plutôt qu'un seul fichier **xorg.conf** contenant toutes les sections, chacune est désormais dispatchée en multiples sous-fichiers, soit dans **/etc/X11/xorg.conf.d/** soit 
  * pour __Ubuntu [[:Lucid|10.04 LTS]]:__ dans le dossier **/usr/lib/X11/xorg.conf.d/**
  * pour __Ubuntu [[:Maverick|10.10]] et supérieures:__ dans le dossier **/usr/share/X11/xorg.conf.d/**
</note>

Voici un fichier Xorg basique :
<file>
# /etc/X11/xorg.conf (xorg X Window System server configuration file)
#
# This file was generated by dexconf, the Debian X Configuration tool, using
# values from the debconf database.
#
# Edit this file with caution, and see the /etc/X11/xorg.conf manual page.
# (Type "man /etc/X11/xorg.conf" at the shell prompt.)
#
# This file is automatically updated on xserver-xorg package upgrades *only*
# if it has not been modified since the last upgrade of the xserver-xorg
# package.
#
# If you have edited this file but would like it to be automatically updated
# again, run the following command:
#   sudo dpkg-reconfigure -phigh xserver-xorg

Section "Files"
    FontPath    "/usr/share/X11/fonts/misc"
    FontPath    "/usr/share/X11/fonts/cyrillic"
    FontPath    "/usr/share/X11/fonts/100dpi/:unscaled"
    FontPath    "/usr/share/X11/fonts/75dpi/:unscaled"
    FontPath    "/usr/share/X11/fonts/Type1"
    FontPath    "/usr/share/X11/fonts/100dpi"
    FontPath    "/usr/share/X11/fonts/75dpi"
    # path to defoma fonts
    FontPath    "/var/lib/defoma/x-ttcidfont-conf.d/dirs/TrueType"
EndSection

Section "Module"
    Load    "i2c"
    Load    "bitmap"
    Load    "ddc"
    Load    "dri" ## direct rendering
    Load    "extmod"
    Load    "freetype"
    Load    "glx" ## client GLX pour OpenGL
    Load    "int10"
    Load    "type1"
    Load    "vbe"
EndSection

Section "InputDevice"
    Identifier    "Generic Keyboard"
    Driver        "kbd"
    Option        "CoreKeyboard"
    Option        "XkbRules"    "xorg"
    Option        "XkbModel"    "pc105"
    Option        "XkbLayout"    "fr"  # "fr-oss" pour Feisty et +
    Option        "XkbVariant"    "latin9"
EndSection

Section "InputDevice"
    Identifier    "Configured Mouse"
    Driver        "mouse"
    Option        "CorePointer"
    Option        "Device"        "/dev/input/mice"
    Option        "Protocol"        "ExplorerPS/2"
    Option        "ZAxisMapping"        "4 5"
    Option        "Emulate3Buttons"    "true"
EndSection


Section "Device"
    Identifier    "Carte"
    Driver        "vesa" ## nv pour les NVIDIA (libre), ati pour les ATI (libre).
    BusID        "PCI:1:0:0"
EndSection


Section "Monitor"
    Identifier    "Moniteur"
    Option        "DPMS"
##    HorizSync    31-60 ## selon vos valeurs, n'est pas toujours nécessaire.
##    VertRefresh    47.5-125
EndSection


Section "Screen"
    Identifier    "Ecran"
    Device        "Carte"
    Monitor        "Moniteur"
    DefaultDepth    24
    SubSection "Display"
        Depth        16
        Modes        "1024x768" "800x600" "640x480" 
    EndSubSection
    SubSection "Display"
        Depth        24
        Modes        "1024x768" "800x600" "640x480"
    EndSubSection
EndSection

Section "ServerLayout"
    Identifier    "Default Layout"
    Screen        "Ecran"
    InputDevice   "Generic Keyboard"
    InputDevice   "Configured Mouse"
EndSection
</file>





===== Manipulation du fichier « xorg.conf » =====

==== Sauvegarde du fichier ====

Commencez par faire une [[:tutoriel:comment_sauver_et_restaurer_un_fichier|sauvegarde]]de votre fichier de configuration **xorg.conf**.\\
Depuis un [[:terminal]] par exemple, vous pouvez saisir la [[:commande_shell|commande]] suivante:
<code>sudo cp /etc/X11/xorg.conf /etc/X11/xorg.conf.bak</code>
En cas d'échec de vos tentatives de configuration, vous pouvez rétablir votre configuration graphique précédente en restaurant votre fichier **xorg.conf.bak** avec la commande :
<code>sudo cp /etc/X11/xorg.conf.bak /etc/X11/xorg.conf</code>

<note tip>En cas de besoin vous pourrez restaurer le fichier de sauvegarde depuis le [[:recovery mode]]</note>

==== Ouverture du fichier ====

[[:tutoriel:comment_editer_un_fichier|Éditez avec les droits d'administration]] le fichier **/etc/X11/xorg.conf**

<note tip>Quand il n'y a plus d'interface graphique suite à une mauvaise modification du fichier **xorg.conf**, il vous faudra utiliser [[:editeur_de_texte#editeurs_en_ligne_de_commande|un éditeur en mode console]]</note>



===== Configuration de X.org en mode graphique=====

==== Automatique ====
Pour reconfigurer X.org automatiquement, 3 solutions :

  * Cas général (à tester en premier): <code>sudo dpkg-reconfigure -phigh xserver-xorg</code> comme suggéré au début du fichier **/etc/X11/xorg.conf**
  * Cartes nvidia: <code>sudo nvidia-xconfig</code>
  * Cartes ATI (aurait tendance à ne pas fonctionner, donc attention !!): <code>sudo aticonfig --initial</code>

Sur les dernières versions, il existe également [[#Comment régénérer un nouveau fichier xorg.conf?|cette possibilité]]

==== Manuelle ====
Pour reconfigurer X.org manuellement :

  - [[:tutoriel:comment_editer_un_fichier#partout_meme_sans_interface_graphique|éditez avec les droits d'administration]] le fichier **/etc/X11/xorg.conf**.
  - Modifier ce qui ne va pas.
  - Puis :
    * Si vous êtes en mode graphique, [[:tutoriel:comment_redemarrer_le_serveur_graphique|redémarrez Xorg]],
    * Si vous êtes en mode console, lancez "[[#en_mode_console_comment_je_demarre_le_graphique|startx]]"

===== FAQ =====

==== Comment redémarrer Xorg ? ====

Consulter le tutoriel : [[:tutoriel:comment_redemarrer_le_serveur_graphique|Comment redémarrer le serveur graphique]]

==== Que faire s'il n'y a pas de fichier xorg.conf sur le disque? ====

Si vous possédez une version de Linux récente, il se peut qu'aucun fichier **xorg.conf** ne soit disponible à l'emplacement **/etc/X11**. Dans ce cas, voici comment procéder :\\
Tout d'abord, vérifiez que le tutoriel en question est toujours valable. Avec les récents progrès de Xorg, ce fichier n'est plus forcément nécessaire et le mode de résolution de votre problème a pu changer. 

Si ce n'est pas le cas, commencez par vérifier qu'aucune ancienne sauvegarde de votre fichier xorg.conf n'existe :
<code>ls -l /etc/X11/</code>

Si vous voyez un fichier dont le nom commence par **xorg.conf**, avec une extension supplémentaire comme //.conf, .bak, .anc//, etc, il peut s'agir d'une ancienne sauvegarde. Vous pouvez alors essayer de la [[:xorg#manipulation_du_fichier_xorgconf|restaurer]] et d'en repartir pour la suite du tutoriel. Sinon, voyez la section [[:xorg#comment_regenerer_un_nouveau_fichier_xorgconf|Comment régénérer un nouveau fichier xorg.conf ?]]

==== Comment régénérer un nouveau fichier xorg.conf en mode console ? ====

Si vous possédez déjà un fichier **xorg.conf** dans **/etc/X11**, vous pouvez commencer par en [[:xorg#sauvegarde_du_fichier|faire une sauvegarde]].\\
Ceci fait, commencez par// basculer en mode console//  CTRL+alt+F1 puis //stoppez le service graphique// :  <code>sudo service lightdm stop</code>
//Générez le fichier// **xorg.conf.new** par la commande :
<code>sudo X -configure</code>
Si cette commande n'est pas reconnue, essayez avec :
<code>sudo Xorg -configure</code>
S'assurer de la présence du fichier par la commande suivante :
<code>ls -l /etc/X11</code>
qui liste le répertoire **/etc/X11**, dans lequel doit apparaître le fichier nouvellement généré **xorg.conf.new**

//Copiez ensuite le fichier// nouvellement généré à l'endroit approprié :
<code>sudo cp ~/xorg.conf.new /etc/X11/xorg.conf</code>
//Relancez enfin le service graphique//: <code>sudo service lightdm start</code>


<note tip>Si vous ne parvenez pas à arrêter correctement le service X, vous pouvez également effectuer la manipulation depuis la [[:recovery_mode|console de récupération]]. Celle-ci vous sera également très utile pour supprimer votre fichier **xorg.conf** (et éventuellement [[:xorg#sauvegarde_du_fichier|restaurer une ancienne sauvegarde]]) s'il s'avère que suite à cette manipulation votre système ne veut plus démarrer.</note>

==== Que faire en cas de résolution trop grande pour l'écran? ====
=== Pour tout le système ===
Si, dès le lancement de l'interface graphique, vous ne pouvez plus rien voir sur votre écran car celui-ci ne supporte pas une trop grande résolution, ouvrez une [[:console]] puis [[:tutoriel:comment_modifier_un_fichier|modifier avec les droits d'administration]] le fichier ** /etc/X11/xorg.conf ** pour rajouter une sous section ''Display'' à la section ''Screen'' comme dans le [[#structure_d_un_fichier_xorg_basique|fichier exemple]].
<file bash /etc/X11/xorg.conf>
Section "Screen"
        Identifier      "Default Screen"
        DefaultDepth    24
    SubSection "Display"
        Depth        16
        Modes        "1024x768" "800x600" "640x480" 
    EndSubSection
    SubSection "Display"
        Depth        24
        Modes        "1024x768" "800x600" "640x480"
    EndSubSection
EndSection
</file>

=== Pour un utilisateur ===

<note>D'après [[http://forum.ubuntu-fr.org/viewtopic.php?id=1237181|ce sujet du forum]], sous  [[:Quantal|Ubuntu 12.10]], ce fichier permet également de paramétrer les différents écrans dans le cas d'une configuration [[:multi-écran]]</note>

La configuration de l'écran est gérée par l'utilisateur et est défini dans le fichier **~/.config/monitors.xml** ((le tilde ~ représentant votre //Dossier Personnel//)).\\
Il suffit d'[[:tutoriel:comment_modifier_un_fichier|éditer ce fichier]] pour forcer une résolution et un rafraîchissement. Par exemple
<file><configuration>
      <clone>no</clone>
      <output name="default">
          <vendor>???</vendor>
          <product>0x0000</product>
          <serial>0x00000000</serial>
          <width>1024</width> # Largeur de l'écran
          <height>768</height> # Hauteur de l'écran
          <rate>60</rate> #taux de rafraichissement (Hz)
          <x>0</x>
          <y>0</y>
          <rotation>normal</rotation>
          <reflect_x>no</reflect_x>
          <reflect_y>no</reflect_y>
      </output>
  </configuration>
</monitors></file>

==== Comment démarrer le mode graphique depuis la console ? ====

Il est possible de démarrer le mode graphique depuis une [[:console]] en saisissant la commande :
<code>
startx
</code>

Cette commande ne marchera que si une session X n'est pas déjà en fonctionnement. En effet, par défaut, une seule session graphique est proposée.

<note tip>Sur les versions utilisant [[apt>gdm]], il est possible de le paramétrer pour lancer deux sessions X voire plus (cf lien dans la section [[#Voir Aussi]]).\\
FIXME pour les versions sous [[:Lightdm]] ?
</note>

==== Que faire en cas d'écran bleu parlant de "Xorg.0.log"? ====

Votre configuration de Xorg pose problème. Remettez une ancienne version du fichier **xorg.conf**. Si vous voulez avoir un semblant d'explication, vous pouvez lire le fichier **/var/log/Xorg.0.log**, par exemple avec la commande :

<code>
less /var/log/Xorg.0.log
</code>


==== Que faire si une mise à jour entraine écran bleu, perte de la 3D, ou retour à la page de login? ====

FIXME si "écran bleu" fait référence à l'[[wpfr>écran bleu de la mort]] (ou BSoD) de Windows, il serait plus juste de parler de [[wpfr>panique du noyau|Kernel Panic ou de panique du noyau]].

Ceci est un problème très courant dû à //xserver-xorg-core// et notamment après la mise à jour d'un [[:noyau]]. Regardez le forum mais généralement:\\
__Les symptômes__:
  * Impossible de lancer le serveur x (d'où l'écran bleu mettant en cause les pilotes graphiques)
  * Retour à la page de login au lancement d'une application 3D (Beryl, compiz, jeu, etc.)

__Solution__: réinstaller vos pilotes graphiques. Si dans vos mises à jour vous voyez //xserver-xorg-core//, il FAUT réinstaller les pilotes si le serveur X plante.


==== Comment activer la sortie TV ? ====
Sur certaines cartes (récentes), le clonage est automatique: reliez votre carte-graphique à votre télé,allumez votre ordinateur, et ça devrait marcher.
Pour le reste:
  * allez voir les tutos : [[:nvidia_tvout|nvidia tvout]] [[:multi-ecran]].
  * Si pour les **ATI** le plug'n'play ne fonctionne pas et qu'il ne s'agit pas d'un problème de connexion de carte dans le port AGP:\\ [[:tutoriel:comment_installer_un_paquet|installer le paquet]] **[[apt>atitvout]]**. FIXME toujours vrai?
  * FIXME DELETEME ? Gutsy et Hardy Pour un **ordinateur portable**, vous pouvez brancher la sortie TV directement. Pour permuter l'affichage, fermez votre PC et rouvrez-le, ça devrait faire l'affaire...

==== Comment calibrer l'écran ? ====

Référez-vous à la documentation sur [[:Argyll|Argyll CMS]]

==== Gestion de l'énergie des écrans DPMS ====

Il faut d'abord s'assurer d'avoir le paquet **[[apt>x11-xserver-utils]]** d'[[:tutoriel:comment_installer_un_paquet|installé]], sinon faites-le.

Vous pouvez visionner l'état de la gestion de l'énergie DPMS (VESA Display Power Management Signaling) avec la commande :
<code>
export DISPLAY=:0
sudo xset -q
</code>

Pour activer la gestion d'énergie DPMS :
<code>
export DISPLAY=:0
sudo xset +dpms
</code>

Pour désactiver la gestion d'énergie DPMS
<code>
export DISPLAY=:0
sudo xset -dpms
</code>

Pour désactiver l'économiseur d'écran :
<code>
export DISPLAY=:0
sudo xset s off
</code>

Pour activer l'économiseur d'écran dans 200s :
<code>
export DISPLAY=:0
sudo xset s 200 
</code>

Pour régler la mise en veille de l'écran :
**xset dpms "Désactivé l'affichage = 200s" "En économie d'énergie = 400s" "Éteindre = 800s"**
<code>
export DISPLAY=:0
sudo xset dpms 200 400 800 
</code>

Pour obliger la désactivation de l'affichage :
<code>
export DISPLAY=:0
sudo xset dpms force standby
</code>

Pour obliger la mise en économie d'énergie :
<code>
export DISPLAY=:0
sudo xset dpms force suspend
</code>

Pour éteindre l'écran :
<code>
export DISPLAY=:0
sudo xset dpms force off
</code>

<note tip>Pour réactiver remplacer **force off** par **force on**</note>

===== Voir Aussi =====
  * [[http://xorg.freedesktop.org/|Site Officiel]] de X.org.
  * [[:carte_graphique|Les cartes graphiques]]
  * [[:acceleration_graphique|La page traitant de l'accélération graphique]] sous Linux

== Effets graphiques ==
  * [[:interface_3d|Effets 3D]] - le point sur les Bureaux 3D
  * [[:Compizconfig-settings-manager]] - gestionnaire de fenêtre "Compiz"

== Serveurs virtuels ==
FIXME utile?
  * Xnest
  * xephyr,
  * xoo

== divers ==
  * [[http://forum.ubuntu-fr.org/viewtopic.php?pid=947925|Piloter Xorg à l'aide d'une manette de jeu]] sur le forum.
  * [[http://contrib.coffee.free.fr/index.php?2007/07/16/31-2-sessions-x|Ouvrir 2 sessions X avec gdm]] sur un blog.

----
// Contributeurs : [[:utilisateurs:adam0509]], [[utilisateurs:Acp]], Boris Le Hachoir, Sponge Bob //